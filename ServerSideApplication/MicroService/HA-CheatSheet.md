[![返回目录](https://parg.co/UCb)](https://github.com/wxyyxc1992/Awesome-CheatSheet)

# 高可用服务架构清单

# Service Degradation | 服务降级

## Throttling | 限流

限流，形象地理解就是在外部系统与内部服务之间添加漏斗状的过滤器，无论输入一侧的流量多少，输出一侧总是以最大可预期的速度进行输出。通常来说，对速率控制可以分为固定速率控制和动态速率控制两种；固定速率控制，根据当前速率决定请求是否被接受，而动态速率控制根据系统压力指标决定请求是否被接受。

固定速率控制常用于预先对系统能力与业务流量估算较好地情况下，可以进行预配置，通常使用 Leaky Bucket 或者 Token Bucket 算法；Nginx 等 Web 服务器，各个语言本身的工具包往往都会支持该系列的算法。

Token Bucket 算法中，有一个独立的模块始终以恒定速率给固定大小的桶补充 token，若桶满了则溢出，即 token 最多为桶的容量；负责处理请求的模块每次接到请求时，首先从桶中获取 token，若能成功获取则继续流程，否则等待响应时间或返回失败。

实际的实现当中，算法可以被优化为系统时间相关的数学运算，也无需单独的线程，仅需要在请求之前插入一小段计算即可实现，因此对性能几乎没有影响。唯一需要考虑的是系统对于获取当前时间的精度支持，这影响速率控制的精度。
